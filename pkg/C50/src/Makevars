.POSIX:

.PHONY: all stdioctcl cfive tclcfive

export CC CFLAGS CPPFLAGS LDFLAGS

all: $(SHLIB)

$(SHLIB): stdioctcl cfive tclcfive

stdioctcl:
	cd stdioctcl ;\
	support/tmk/src/tmk
	cp -fp stdioctcl/stdioctcl/build/libstdioctcl.so $(PWD) 

cfive: stdioctcl
	CPPFLAGS="-I../../stdioctcl/include $$CPPFLAGS" ;\
	export CPPFLAGS ;\
	LDFLAGS="-L../../stdioctcl/stdioctcl/build -Wl,-rpath,\\\$$ORIGIN -Wl,-rpath,\\\$$ORIGIN/../libs" ;\
	export LDFLAGS ;\
	cd cfive ;\
	support/tmk/src/tmk -D USE_STDIOCTCL_REDEFINE
	cp -fp cfive/cfive/build/libcfive.so $(PWD) 

tclcfive: cfive
	cd tclcfive ;\
	CPPFLAGS="-I../../cfive/cfive $$CPPFLAGS" ;\
	export CPPFLAGS ;\
	LDFLAGS="-L../../cfive/cfive/build -Wl,-rpath,\\\$$ORIGIN -Wl,-rpath,\\\$$ORIGIN/../libs" ;\
	export LDFLAGS ;\
	support/tmk/src/tmk
	cp -fp tclcfive/tclcfive/build/libtclcfive.so $(PWD)/../inst/tclcfive
	cp -fp tclcfive/tclcfive/cfive.tcl $(PWD)/../inst/tclcfive
	cp -fp tclcfive/tclcfive/inmemvfs.tcl $(PWD)/../inst/tclcfive
	cp -fp tclcfive/tclcfive/pkgIndex.tcl $(PWD)/../inst/tclcfive
	rm -f $(PWD)/../inst/tclcfive/empty
