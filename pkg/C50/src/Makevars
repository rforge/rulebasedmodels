.POSIX:

.PHONY: all stdioctcl cfive tclcfive

.EXPORT_ALL_VARIABLES: 

all: $(SHLIB)

$(SHLIB): stdioctcl cfive tclcfive

#on OS X, lzma is not available, we don't need it in any case

stdioctcl:
	cd stdioctcl ;\
	support/tmk/src/tmk
	cp -fp stdioctcl/stdioctcl/build/libstdioctcl.so $(PWD) 

cfive: stdioctcl
	CPPFLAGS="-I../../cfive/cfive $$CPPFLAGS" ;\
	export CPPFLAGS ;\
	LDFLAGS="-L../../stdioctcl/stdioctcl/build -Wl,-rpath,\\\$$ORIGIN -Wl,-rpath,\\\$$ORIGIN/../libs" ;\
	export LDFLAGS ;\
	cd cfive ;\
	support/tmk/src/tmk -D USE_STDIOCTCL_REDEFINE
	cp -fp cfive/cfive/build/libcfive.so $(PWD) 

tclcfive: cfive
	CPPFLAGS="-I../../cfive/cfive $$CPPFLAGS" ;\
	export CPPFLAGS ;\
	LDFLAGS="-L../../cfive/cfive/build -Wl,-rpath,\\\$$ORIGIN -Wl,-rpath,\\\$$ORIGIN/../libs" ;\
	export LDFLAGS ;\
	cd tclcfive ;\
	support/tmk/src/tmk
	cp -fp tclcfive/tclcfive/build/libtclcfive.so $(PWD)/../inst/tclcfive
	cp -fp tclcfive/tclcfive/cfive.tcl $(PWD)/../inst/tclcfive
	cp -fp tclcfive/tclcfive/inmemvfs.tcl $(PWD)/../inst/tclcfive
	cp -fp tclcfive/tclcfive/pkgIndex.tcl $(PWD)/../inst/tclcfive
	rm -f $(PWD)/../inst/tclcfive/empty
