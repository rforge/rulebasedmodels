TMK_MODULE_PATH = $(PWD)/../tmk
#export BLAS_LIBS
tmkcmd = $(PWD)/../support/tmk/src/tmk
#tmkopts = -mod rext

.PHONY: all stdioctcl cfive tclcfive
.EXPORT_ALL_VARIABLES: 

all: $(SHLIB)

$(SHLIB): stdioctcl cfive tclcfive

stdioctcl:
	cd stdioctcl ;\
	support/tmk/src/tmk $(tmkopts) ;
	cp -fp stdioctcl/stdioctcl/build/libstdioctcl.so $(PWD) 

cfive: stdioctcl
	CFLAGS="-I../../stdioctcl/include" ;\
	export CFLAGS ;\
	LDFLAGS="-L../../stdioctcl/stdioctcl/build -Wl,-rpath,\\\$$ORIGIN -Wl,-rpath,\\\$$ORIGIN/../libs" ;\
	export LDFLAGS ;\
	cd cfive ;\
	support/tmk/src/tmk $(tmkopts) -D USE_STDIOCTCL_REDEFINE ;
	cp -fp cfive/cfive/build/libcfive.so $(PWD) 

tclcfive: cfive
	cd tclcfive ;\
	CFLAGS="-I../../cfive/cfive" ;\
	export CFLAGS ;\
	LDFLAGS="-L../../cfive/cfive/build -Wl,-rpath,\\\$$ORIGIN -Wl,-rpath,\\\$$ORIGIN/../libs" ;\
	export LDFLAGS ;\
	support/tmk/src/tmk $(tmkopts)
	cp -fp tclcfive/tclcfive/build/libtclcfive.so $(PWD)/../inst/tclcfive
	cp -fp tclcfive/tclcfive/cfive.tcl $(PWD)/../inst/tclcfive
	cp -fp tclcfive/tclcfive/inmemvfs.tcl $(PWD)/../inst/tclcfive
	cp -fp tclcfive/tclcfive/pkgIndex.tcl $(PWD)/../inst/tclcfive
	rm -f $(PWD)/../inst/tclcfive/empty
